# ============================================
# KERBERUS - Swiss Legal Intelligence Platform
# Environment Configuration Template
# ============================================
# Copy this file to .env and fill in your values
# NEVER commit .env to version control!
# ============================================

# ============================================
# APPLICATION SETTINGS
# ============================================
APP_ENV=development
APP_NAME=KERBERUS
LOG_LEVEL=INFO
SECRET_KEY=generate_random_64_char_secret_here

# ============================================
# DATABASE - PostgreSQL (Auth & Metadata)
# ============================================
POSTGRES_HOST=localhost
POSTGRES_PORT=5432
POSTGRES_DB=kerberus_dev
POSTGRES_USER=kerberus_user
POSTGRES_PASSWORD=change_me_in_production

# ============================================
# DATABASE - SQLCipher (Encrypted Dossiers)
# ============================================
DOSSIER_STORAGE_PATH=./data/dossier
SQLCIPHER_ENCRYPTION_ALGORITHM=aes-256-gcm
SQLCIPHER_ITERATIONS=256000
MAX_DOSSIER_SIZE_MB=1024

# ============================================
# REDIS (Sessions & Rate Limiting)
# ============================================
REDIS_HOST=localhost
REDIS_PORT=6379
REDIS_PASSWORD=
REDIS_DB=0

# ============================================
# QDRANT (Vector Database)
# ============================================
QDRANT_HOST=localhost
QDRANT_PORT=6333
QDRANT_API_KEY=
QDRANT_COLLECTION_CODEX=codex
QDRANT_COLLECTION_LIBRARY=library

# ============================================
# AUTHENTICATION & SECURITY
# ============================================
JWT_SECRET=generate_another_random_secret_here
JWT_ALGORITHM=HS256
JWT_EXPIRATION_HOURS=12
SESSION_EXPIRATION_HOURS=12
MFA_ISSUER=KERBERUS

# ============================================
# RATE LIMITING
# ============================================
RATE_LIMIT_DAILY=300
RATE_LIMIT_HOURLY=50
RATE_LIMIT_ENABLED=true

# ============================================
# AI MODEL SETTINGS
# ============================================
# Mistral AI (Primary - for development and production)
MISTRAL_API_KEY=your_mistral_api_key_here
MISTRAL_MODEL=mistral-small-latest
# Options: mistral-small-latest, mistral-large-latest, open-mistral-nemo

# Alternative: Qwen3-VL via Infomaniak (Swiss sovereign option)
QWEN_API_KEY=your_infomaniak_api_key_here
QWEN_API_URL=https://api.infomaniak.com/ai/qwen
QWEN_MODEL=qwen3-vl-235b-instruct

# Generic LLM API Key (fallback)
LLM_API_KEY=your_api_key_here

# Pricing (for cost tracking and monitoring)
MISTRAL_INPUT_COST_PER_M=0.20   # CHF per 1M input tokens (mistral-small)
MISTRAL_OUTPUT_COST_PER_M=0.60  # CHF per 1M output tokens

# Development Mode (use mock responses - no API key needed)
# Set to false in production when you have real API keys
USE_MOCK_AI=false

# ============================================
# CONTEXT MANAGEMENT (Day 5 - Dynamic Swapping)
# ============================================
# "The Sliding Window of Truth" pattern
# Prevents token bloat by replacing legal context on each turn
MAX_CONTEXT_TOKENS=4000        # Max tokens for legal context per turn
MAX_CHAT_HISTORY_TURNS=5       # Keep last 5 conversation turns in memory
ENABLE_CONTEXT_SWAPPING=true   # Always replace legal docs (don't accumulate)

# Token Budget Limits
HARD_TOKEN_LIMIT=12000         # Emergency cap per request
WARN_TOKEN_THRESHOLD=10000     # Warning threshold for monitoring

# ============================================
# TOKEN USAGE TRACKING
# ============================================
ENABLE_TOKEN_TRACKING=true
TOKEN_USAGE_LOG_PATH=./logs/token_usage.jsonl
ALERT_COST_THRESHOLD_CHF=50.00  # Alert if user exceeds CHF 50/month

# ============================================
# EMBEDDING MODELS (Local)
# ============================================
BGE_MODEL_NAME=BAAI/bge-m3
BGE_RERANKER_MODEL_NAME=BAAI/bge-reranker-v2-m3
EMBEDDER_DEVICE=mps
EMBEDDER_MAX_LENGTH=8192
RERANKER_DEVICE=cpu
RERANKER_MAX_LENGTH=512

# ============================================
# FEATURE FLAGS
# ============================================
ENABLE_MFA=true
ENABLE_PII_SCRUBBING=true
ENABLE_FIRM_DOSSIER=false
ENABLE_CITATION_VALIDATION=true

# ============================================
# FIRM FEATURES (Phase 2)
# ============================================
# Firm master key storage options: kms, vault, file
FIRM_MASTER_KEY_STORAGE=file  # Use 'file' for dev, 'kms' or 'vault' for production
FIRM_MASTER_KEY_KMS_PATH=     # Infomaniak KMS path (production)
FIRM_MASTER_KEY_VAULT_PATH=   # HashiCorp Vault path (alternative)
FIRM_MASTER_KEY_FILE_PATH=./data/dossier/.firm_master_key  # DEV ONLY - DO NOT use in production
